<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Energy Systems (IES) Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js for graphs and figures -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .card-shadow { box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); }
        /* Use a CSS variable for the active tab color for easy access in CSS */
        :root {
            --nuclear-blue-dark: #1e40af; /* Darker shade for contrast */
        }
        .tab-button.active { 
            border-bottom: 4px solid var(--nuclear-blue-dark); 
            font-weight: 700; 
            color: var(--nuclear-blue-dark); 
        }
        .tab-button { transition: all 0.3s ease; }
        /* Ensure the canvas element itself is set to block for proper Chart.js rendering */
        canvas { display: block; width: 100%; height: 100%; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'nuclear-blue': '#2563EB',
                        'emissions-red': '#DC2626',
                        'steam-green': '#10B981',
                        'power-yellow': '#FBBF24',
                        'bg-dark': '#0f172a',
                    }
                }
            }
        }
    </script>

    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Header -->
        <header class="bg-nuclear-blue p-6 rounded-xl shadow-lg mb-8 text-white card-shadow">
            <h1 class="text-3xl sm:text-4xl font-bold mb-2">Nuclear IES Feasibility Report</h1>
            <p class="text-nuclear-blue-100 opacity-80">Interactive Summary of Technology Selection and Preliminary Integration at Dow Manufacturing Sites (INL/RPT-24-78505)</p>
        </header>

        <!-- Site Selection Tabs -->
        <div class="bg-white rounded-xl shadow-lg mb-6 card-shadow">
            <div class="flex border-b border-gray-200">
                <button id="tab-sco-btn" class="tab-button px-6 py-3 text-lg text-gray-600 focus:outline-none active" onclick="switchTab('sco')">
                    St. Charles Operations (SMR)
                </button>
                <button id="tab-carrollton-btn" class="tab-button px-6 py-3 text-lg text-gray-600 focus:outline-none" onclick="switchTab('carrollton')">
                    Carrollton Site (ÂµRx)
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div id="site-content" class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Site 1: St. Charles Operations (SCO) Content -->
            <div id="sco-content" class="site-tab lg:col-span-3 grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <!-- Overview & Summary Card -->
                <div class="lg:col-span-1 bg-white p-6 rounded-xl card-shadow h-full">
                    <h2 class="text-2xl font-bold text-nuclear-blue mb-4">Key Findings: SCO</h2>
                    <p class="text-gray-700 leading-relaxed mb-4">
                        The SCO site requires large-scale thermal and electric capacity. Optimized solutions favored sets of either **HTGRs (800 MWth)** or **LWRs (1250 MWth)**, with costs being statistically indistinguishable.
                    </p>
                    <ul class="list-disc list-inside space-y-2 text-sm text-gray-600">
                        <li><strong>Optimal Capacity:</strong> 800 MWth (HTGR) or 1250 MWth (LWR).</li>
                        <li><strong>Integration:</strong> Seamless integration into HP, IP, and LP steam headers.</li>
                        <li><strong>TES Impact:</strong> Thermal Energy Storage (TES) showed limited economic utility outside of managing short-term supply reliability.</li>
                    </ul>

                    <h3 class="text-xl font-bold text-gray-800 mt-6 mb-3">Economic Summary</h3>
                    <table class="min-w-full divide-y divide-gray-200 text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Metric</th>
                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Value</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr>
                                <td class="px-3 py-2 whitespace-nowrap text-gray-900">Total Site Emissions (Base 2021)</td>
                                <td class="px-3 py-2 whitespace-nowrap text-right text-gray-900">~2.1 Million tons/year</td>
                            </tr>
                            <tr>
                                <td class="px-3 py-2 whitespace-nowrap text-gray-900">Annual CO2 Reduction (Target)</td>
                                <td class="px-3 py-2 whitespace-nowrap text-right font-semibold text-steam-green">~615,000 tons/year (30%)</td>
                            </tr>
                            <tr>
                                <td class="px-3 py-2 whitespace-nowrap text-gray-900">Optimal NPV Solutions</td>
                                <td class="px-3 py-2 whitespace-nowrap text-right text-gray-900">Statistically Indistinguishable</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Emissions Reduction Chart (SCO) -->
                <div class="lg:col-span-2 bg-white p-6 rounded-xl card-shadow">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">St. Charles Combustion Emissions Reductions (2021 Base)</h3>
                    <div style="height: 350px;">
                        <canvas id="scoEmissionsChart"></canvas>
                    </div>
                    <p class="text-xs text-gray-500 mt-4">Integration of SMRs phased out baseload generation from fossil-fuel boilers and CHP units.</p>
                </div>

                <!-- Combined Demand Profile Chart -->
                <div class="lg:col-span-3 bg-white p-6 rounded-xl card-shadow">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Comparative Energy Demand Profiles (SCO vs. Carrollton)</h3>
                    <div style="height: 450px;">
                        <canvas id="combinedDemandChart"></canvas>
                    </div>
                    <p class="text-xs text-gray-500 mt-4">SCO exhibits high-volume, dynamic loads over a year (Hourly). Carrollton exhibits low-volume, high-ratio (6:1 thermal:electric) loads (Monthly average visualization).</p>
                </div>
            </div>
            
            <!-- Site 2: Carrollton Site (DSC) Content -->
            <div id="carrollton-content" class="site-tab lg:col-span-3 grid grid-cols-1 lg:grid-cols-3 gap-6 hidden">
                
                <!-- Overview & Summary Card -->
                <div class="lg:col-span-1 bg-white p-6 rounded-xl card-shadow h-full">
                    <h2 class="text-2xl font-bold text-nuclear-blue mb-4">Key Findings: Carrollton</h2>
                    <p class="text-gray-700 leading-relaxed mb-4">
                        The Carrollton site's demands (high thermal, low electric) are too small for efficient SMR use, making microreactors ($\mu$Rx) the optimal choice for steam generation.
                    </p>
                    <ul class="list-disc list-inside space-y-2 text-sm text-gray-600">
                        <li><strong>Optimal Capacity:</strong> 167.3 MWth ($\mu$Rx).</li>
                        <li><strong>Energy Mix:</strong> Very high thermal to electric ratio (~6:1).</li>
                        <li><strong>TES Impact:</strong> Optimization selected a mandatory **183.2 MWh-th TES** system to manage high thermal demand peaks and oscillations.</li>
                    </ul>

                    <h3 class="text-xl font-bold text-gray-800 mt-6 mb-3">Economic Summary</h3>
                    <table class="min-w-full divide-y divide-gray-200 text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Metric</th>
                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Value</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr>
                                <td class="px-3 py-2 whitespace-nowrap text-gray-900">Total Site Emissions (Base 2021)</td>
                                <td class="px-3 py-2 whitespace-nowrap text-right text-gray-900">~174,000 tons/year</td>
                            </tr>
                            <tr>
                                <td class="px-3 py-2 whitespace-nowrap text-gray-900">Annual CO2 Reduction (Target)</td>
                                <td class="px-3 py-2 whitespace-nowrap text-right font-semibold text-steam-green">174,000 tons/year (100% combustion)</td>
                            </tr>
                            <tr>
                                <td class="px-3 py-2 whitespace-nowrap text-gray-900">Optimal TES Capacity</td>
                                <td class="px-3 py-2 whitespace-nowrap text-right text-gray-900">183.2 MWh-th</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Emissions Reduction Chart (Carrollton) -->
                <div class="lg:col-span-2 bg-white p-6 rounded-xl card-shadow">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Carrollton Combustion Emissions Reductions (2021 Base)</h3>
                    <div style="height: 350px;">
                        <canvas id="carrolltonEmissionsChart"></canvas>
                    </div>
                    <p class="text-xs text-gray-500 mt-4">The proposed ÂµRx integration would entirely eliminate combustion CO2 emissions by replacing fossil fuel boilers.</p>
                </div>

                <!-- Spacer to keep layout consistent -->
                <div class="lg:col-span-3"></div>
            </div>

        </div>
    </div>

    <!-- JavaScript for Interactivity and Charts -->
    <script>
        // --- Data from PDF Report ---

        // SCO Demand Data (Figure 3 - Sampled values for visualization)
        // High volume, hourly resolution -> Annual profile shape
        const scoDemandData = {
            // Note: Labels are just indices/markers for a general trend visualization (8760 hours)
            labels: [0, 1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 8760],
            heat: [450, 400, 300, 380, 420, 320, 400, 350, 450, 380], // MWth
            electricity: [175, 165, 170, 180, 190, 185, 160, 175, 195, 170] // MWe
        };

        // Carrollton Demand Data (Figure 6 - Sampled values for visualization)
        // Low volume, monthly resolution -> Seasonal profile shape
        const carrolltonDemandData = {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            heat: [150, 160, 170, 175, 165, 100, 140, 120, 80, 140, 160, 180], // MWth (Average demand profile shape)
            electricity: [20, 19, 21, 18, 20, 16, 18, 17, 16, 14, 18, 21] // MWe (Average profile shape)
        };

        // SCO Emissions Data (Figure ES i) - in k tons/year for chart consistency/scaling
        const scoEmissions = {
            labels: ['Base Emissions (2.1M t/yr)', 'SMR Integration', 'Resultant Emissions (1.485M t/yr)'],
            datasets: [
                {
                    label: 'Combustion Emissions',
                    data: [1500, 0, 1485],
                    backgroundColor: '#A0AEC0', // Gray for general combustion
                    stack: 'Stack 0'
                },
                {
                    label: 'Steam Emissions',
                    data: [350, 0, 0],
                    backgroundColor: '#075985', // Darker Blue
                    stack: 'Stack 0'
                },
                {
                    label: 'Electricity Emissions',
                    data: [250, 0, 0],
                    backgroundColor: '#FBBF24', // Yellow
                    stack: 'Stack 0'
                },
                {
                    label: 'Nuclear Displacement',
                    data: [0, 615, 0],
                    backgroundColor: '#16A34A', // Green for reduction/clean source
                    stack: 'Stack 1'
                }
            ]
        };
        
        // Carrollton Emissions Data (Figure ES ii) - in k tons/year
        const carrolltonEmissions = {
            labels: ['Base Emissions (174k t/yr)', 'ÂµRx Integration', 'Resultant Emissions (0 t/yr)'],
            datasets: [
                {
                    label: 'Steam Emissions',
                    data: [174, 0, 0],
                    backgroundColor: '#075985', // Darker Blue
                    stack: 'Stack 0'
                },
                {
                    label: 'Nuclear Displacement',
                    data: [0, 174, 0],
                    backgroundColor: '#16A34A', // Green for reduction/clean source
                    stack: 'Stack 1'
                }
            ]
        };

        // --- Chart Instance Management ---
        let scoEmissionsChartInstance = null;
        let carrolltonEmissionsChartInstance = null;
        let combinedDemandChartInstance = null;
        
        // Helper function to destroy a chart instance
        function destroyChart(instance) {
            if (instance) {
                instance.destroy();
            }
        }

        // --- Chart Rendering Functions ---

        function renderEmissionsChart(site) {
            const data = site === 'sco' ? scoEmissions : carrolltonEmissions;
            const chartId = site === 'sco' ? 'scoEmissionsChart' : 'carrolltonEmissionsChart';
            let chartInstance = site === 'sco' ? scoEmissionsChartInstance : carrolltonEmissionsChartInstance;

            destroyChart(chartInstance);
            
            const ctx = document.getElementById(chartId).getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            grid: { display: false }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: site === 'sco' ? 'CO2 Emissions (M tons/year)' : 'CO2 Emissions (k tons/year)'
                            }
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom' },
                        title: { display: false }
                    }
                }
            });

            if (site === 'sco') scoEmissionsChartInstance = chartInstance;
            else carrolltonEmissionsChartInstance = chartInstance;
        }

        function renderCombinedDemandChart() {
            destroyChart(combinedDemandChartInstance);

            const ctx = document.getElementById('combinedDemandChart').getContext('2d');
            combinedDemandChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['St. Charles (Thermal)', 'St. Charles (Electric)', 'Carrollton (Thermal)', 'Carrollton (Electric)'],
                    datasets: [
                        {
                            label: 'Average Energy Demand (MW)',
                            data: [
                                // Average SCO Heat (approx)
                                scoDemandData.heat.reduce((a, b) => a + b, 0) / scoDemandData.heat.length,
                                // Average SCO Electric (approx)
                                scoDemandData.electricity.reduce((a, b) => a + b, 0) / scoDemandData.electricity.length,
                                // Average Carrollton Heat (approx)
                                carrolltonDemandData.heat.reduce((a, b) => a + b, 0) / carrolltonDemandData.heat.length,
                                // Average Carrollton Electric (approx)
                                carrolltonDemandData.electricity.reduce((a, b) => a + b, 0) / carrolltonDemandData.electricity.length
                            ],
                            backgroundColor: ['#DC2626', '#2563EB', '#F59E0B', '#10B981'],
                            borderColor: 'white',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Average Demand (MW)'
                            }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: 'Average Site Energy Demand Comparison' }
                    }
                }
            });
        }

        // --- Tab Logic ---

        function switchTab(target) {
            document.querySelectorAll('.site-tab').forEach(tab => {
                tab.classList.add('hidden');
            });
            document.getElementById(`${target}-content`).classList.remove('hidden');

            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`tab-${target}-btn`).classList.add('active');

            // Render charts for the active tab
            if (target === 'sco') {
                renderEmissionsChart('sco');
                // The combined chart is now in the SCO tab
                renderCombinedDemandChart();
            } else {
                renderEmissionsChart('carrollton');
            }
        }

        // Initial setup on window load
        window.onload = function() {
            // Initialize and render the default tab
            switchTab('sco');
        };
    </script>

</body>
</html>
